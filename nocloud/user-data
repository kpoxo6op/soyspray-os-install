#cloud-config
autoinstall:
  version: 1
  identity:
    hostname: k8s-node-1
    username: ubuntu
    # mkpasswd -m sha-512 123
    password: "$6$woKNTIGG4EIjt5vX$Ty3PkCtU6.jU286UCGdQNPA7OHPf97BRIFwhzeKEF5qcTrjLgqXxFKa2rSoBm5TzS9Cih.RMgTYOT505vUBGj."
  ssh:
    install-server: true
    allow-pw: yes
    authorized-keys:
      - "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCr7WZBwguXRF8o+mVtM7iHyzR14nU8bFIQcScSFphYkNEyK3ThkauVEc3zZzGi6F1ZaBS1pDDIBIPO7nASB444jkJAw9rKbkKZYXdqB2B9vIAFCRT8/tnR+ckKtX57C2DlE9924+e6PiOyeZXNMBmqfb35PjszISOKWiZPw42k1yCAcaNnMSZTWp2/7h8yOMFogwhL7xjEGHizBwSqICA0upT39S9PQUiGhRvhjYUqejOUd5zuAd2+wkRgq4kU43alYZjCUPqBJOt4VUQaBi0Ex3vJaijmkYAJ+THU1TvkLZ4dCu4+UvFoKxODLLpFZMPXHJovnn2K2RYuibcMK4KB boris@borex-pc"
  # network:
  #   version: 2
  #   renderer: NetworkManager
  #   ethernets:
  #     all-en:
  #       match:
  #         name: en*
  #       dhcp4: true
  #       dhcp-identifier: mac
  # packages:
  # - python3
  # - python3-pip
  # - git
  # - sshpass

  # https://askubuntu.com/questions/908752/copy-extract-and-launch-a-script-upon-ubuntu-installation
  late-commands:
    - echo 'ubuntu ALL=(ALL) NOPASSWD:ALL' >> /target/etc/sudoers
    - cp -r /cdrom/yt6801-linux-driver-1.0.29 /target/home/
    - cp -r /cdrom/driver-build-packages/*.deb /target/home/
    # - curtin in-target --target=/target -- /bin/dpkg -i /target/tmp/*.deb
    # - curtin in-target --target=/target -- /bin/bash /target/tmp/yt6801-linux-driver-1.0.29/yt_nic_install.sh
    # - sleep 60
  # https://medium.com/@Phoenixforge/diving-deeper-with-ubuntu-autoinstall-b15e5bdffbb5
  user-data:
    runcmd:
      - ls -l /home
  locale: en_NZ.UTF-8
  keyboard:
    layout: us
  timezone: Pacific/Auckland
  storage:
    layout:
      name: direct
      match:
        size: 1G to 500G
      preserve: false
      swap: false
  shutdown: reboot
